/**
 * AI Fusion Task Types (Epic-17)
 * 
 * AI 图片融合任务相关类型定义
 * 基于阿里云 DashScope Image-to-Image API (wan2.5-i2i-preview)
 */

/**
 * AI 融合任务状态
 */
export type AIFusionTaskStatus = 'pending' | 'processing' | 'completed' | 'failed'

/**
 * AI 融合任务记录
 */
export interface AIFusionTask {
  /** 任务 ID */
  id: string
  
  /** 用户 ID */
  user_id: string
  
  // ===== 输入参数 =====
  
  /** 源照片 ID 数组（2-10张） */
  source_photo_ids: string[]
  
  /** 用户输入的融合描述 */
  prompt: string
  
  /** 生成参数 */
  parameters: AIFusionParameters
  
  // ===== 任务状态 =====
  
  /** DashScope API 任务 ID */
  task_id: string | null
  
  /** 任务状态 */
  status: AIFusionTaskStatus
  
  /** 进度百分比 (0-100) */
  progress: number
  
  // ===== 结果数据 =====
  
  /** 生成结果的 OSS URL */
  result_url: string | null
  
  /** 结果保存为新照片的 ID */
  result_photo_id: string | null
  
  /** 错误信息（如果失败） */
  error_message: string | null
  
  // ===== 时间戳 =====
  
  /** 创建时间 */
  created_at: string
  
  /** 更新时间 */
  updated_at: string
  
  /** 完成时间 */
  completed_at: string | null
}

/**
 * AI 融合生成参数
 */
export interface AIFusionParameters {
  /** 输出分辨率，格式：宽*高，如 "1920*1080" */
  size?: string
  
  /** 生成数量（1-4） */
  n?: number
}

/**
 * 创建 AI 融合任务的输入
 */
export interface CreateAIFusionTaskInput {
  /** 源照片 ID 数组（2-10张） */
  source_photo_ids: string[]
  
  /** 用户输入的融合描述 */
  prompt: string
  
  /** 生成参数（可选） */
  parameters?: AIFusionParameters
}

/**
 * 更新 AI 融合任务的输入
 */
export interface UpdateAIFusionTaskInput {
  /** DashScope API 任务 ID */
  task_id?: string
  
  /** 任务状态 */
  status?: AIFusionTaskStatus
  
  /** 进度百分比 */
  progress?: number
  
  /** 生成结果的 OSS URL */
  result_url?: string
  
  /** 结果保存为新照片的 ID */
  result_photo_id?: string
  
  /** 错误信息 */
  error_message?: string
  
  /** 完成时间 */
  completed_at?: string
}

/**
 * DashScope API 响应 - 提交任务
 */
export interface DashScopeSubmitResponse {
  /** 是否成功 */
  success: boolean
  
  /** 任务 ID */
  task_id: string
  
  /** 任务状态 */
  status: string
  
  /** 错误信息 */
  error?: string
}

/**
 * DashScope API 响应 - 查询任务
 */
export interface DashScopeQueryResponse {
  /** 是否成功 */
  success: boolean
  
  /** 任务 ID */
  task_id: string
  
  /** 任务状态 */
  status: string
  
  /** 输出结果 */
  output?: {
    /** 任务 ID */
    task_id: string
    
    /** 任务状态 */
    task_status: 'PENDING' | 'RUNNING' | 'SUCCEEDED' | 'FAILED'
    
    /** 结果列表 */
    results?: Array<{
      /** 结果图片 URL */
      url: string
    }>
    
    /** 错误码 */
    code?: string
    
    /** 错误信息 */
    message?: string
  }
  
  /** 使用量 */
  usage?: {
    /** 图片数量 */
    image_count: number
  }
  
  /** 错误信息 */
  error?: string
}

/**
 * Prompt 模板
 */
export interface PromptTemplate {
  /** 模板 ID */
  id: string
  
  /** 模板名称 */
  name: string
  
  /** 模板分类 */
  category: 'fusion' | 'composite' | 'background' | 'artistic'
  
  /** Prompt 文本 */
  prompt: string
  
  /** 描述 */
  description?: string
}

/**
 * 任务过滤类型
 */
export type TaskFilterType = 'all' | 'active' | 'completed' | 'failed'

/**
 * 任务统计信息
 */
export interface TaskStatistics {
  /** 总任务数 */
  total: number
  
  /** 进行中任务数 */
  active: number
  
  /** 已完成任务数 */
  completed: number
  
  /** 失败任务数 */
  failed: number
  
  /** 成功率 */
  success_rate: number
}

