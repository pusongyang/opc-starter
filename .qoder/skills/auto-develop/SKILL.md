---
name: auto-develop
description: OPC-Starter æ™ºèƒ½å¼€å‘æŠ€èƒ½ã€‚AI äº²å’Œçš„ React Boilerplate é¡¹ç›®å¼€å‘è§„èŒƒï¼Œæ”¯æŒåŠ¨æ€ä¸Šä¸‹æ–‡æ„ŸçŸ¥ã€TDD é©±åŠ¨å¼€å‘ã€Agent Studio æ‰©å±•ã€‚é€‚ç”¨äºè®¤è¯ç³»ç»Ÿã€ç»„ç»‡æ¶æ„ã€Agent å·¥å…·ã€æ•°æ®åŒæ­¥ç­‰æ¨¡å—çš„è¿­ä»£å¼€å‘ã€‚
---

# OPC-Starter æ™ºèƒ½å¼€å‘æŠ€èƒ½

> **é¡¹ç›®å®šä½**: OPC-Starter (ä¸€äººå…¬å¸å¯åŠ¨å™¨) æ˜¯ä¸€ä¸ª AI äº²å’Œçš„ React Boilerplateï¼Œä¸“ä¸ºä½¿ç”¨ Cursorã€Qoder ç­‰ AI Coding å·¥å…·çš„å¼€å‘è€…è®¾è®¡ã€‚
>
> **æ ¸å¿ƒç†å¿µ**: åƒé«˜çº§ç ”å‘ä¸“å®¶ Amelia ä¸€æ ·æ‰§è¡Œ â€”â€” æµ‹è¯•å³è§„èŒƒï¼Œä»£ç å³å®ç°ï¼Œç²¾å‡†å®šä½ï¼Œæ— å†—ä½™è¾“å‡ºã€‚

---

## ğŸ¯ åŠ¨æ€ä¸Šä¸‹æ–‡ç³»ç»Ÿ

### ä¸Šä¸‹æ–‡æ„ŸçŸ¥è§„åˆ™

æ ¹æ®ä»»åŠ¡ç±»å‹è‡ªåŠ¨åŠ è½½ç›¸å…³æ–‡æ¡£å’Œçº¦æŸï¼Œé¿å…æ— å…³ä¿¡æ¯å¹²æ‰°ã€‚

| ä»»åŠ¡å…³é”®è¯ | è§¦å‘ä¸Šä¸‹æ–‡ | åŠ è½½æ–‡æ¡£ |
|------------|------------|----------|
| `Agent`ã€`å·¥å…·`ã€`Tool`ã€`A2UI` | Agent Studio å¼€å‘ | `AGENTS.md` â†’ Agent è§„èŒƒç« èŠ‚ |
| `ç»„ä»¶`ã€`é¡µé¢`ã€`UI`ã€`æ ·å¼` | å‰ç«¯ UI å¼€å‘ | `references/coding-constraints.md` â†’ è®¾è®¡ç³»ç»Ÿ |
| `æ•°æ®åº“`ã€`SQL`ã€`è¡¨`ã€`å­—æ®µ` | æ•°æ®åº“å˜æ›´ | `references/db-sync-checklist.md` |
| `Supabase`ã€`MCP`ã€`åç«¯` | Supabase åç«¯æ“ä½œ | SKILL.md â†’ Supabase MCP è§„èŒƒç« èŠ‚ |
| `æµ‹è¯•`ã€`TDD`ã€`Cypress`ã€`Vitest` | æµ‹è¯•å¼€å‘ | `references/tdd-workflow.md` |
| `Bug`ã€`ä¿®å¤`ã€`å¼‚å¸¸`ã€`æŠ¥é”™` | é—®é¢˜æ’æŸ¥ | `references/troubleshooting.md` |
| `æ¶æ„`ã€`æ¨¡å—`ã€`æœåŠ¡` | ç³»ç»Ÿè®¾è®¡ | `docs/Architecture.md` |

### æ‰§è¡Œå‰è‡ªæ£€

å¼€å§‹ä»»åŠ¡å‰ï¼Œæ£€æµ‹ä»¥ä¸‹æ¡ä»¶å¹¶åŠ¨æ€åŠ è½½è§„åˆ™ï¼š

```yaml
context_check:
  - keyword_match: æ£€æµ‹ä»»åŠ¡æè¿°å…³é”®è¯
  - file_scope: æ£€æµ‹æ¶‰åŠçš„æ–‡ä»¶è·¯å¾„
  - change_type: åˆ¤æ–­æ˜¯æ–°åŠŸèƒ½/Bugä¿®å¤/é‡æ„
  
auto_load:
  agent_module: "app/src/components/agent/**" | "app/src/lib/agent/**"
  ui_module: "app/src/components/**" | "app/src/pages/**"
  data_module: "app/src/services/data/**" | "app/supabase/**"
  test_module: "**/*.test.ts" | "**/*.spec.ts" | "cypress/**"
```

---

## ğŸ“Š é¡¹ç›®æ ¸å¿ƒæ¶æ„

### æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | æ³¨æ„äº‹é¡¹ |
|------|------|----------|
| React | 19.1 | æœ€æ–°ç¨³å®šç‰ˆ |
| TypeScript | 5.9 | ä¸¥æ ¼ç±»å‹ |
| Vite | 7.1 | æ„å»ºå·¥å…· |
| **Tailwind CSS** | **4.1** | âš ï¸ å¿…é¡»ä½¿ç”¨ v4 è¯­æ³• |
| Supabase | 2.80 | Auth + Storage + Realtime + Edge Functions |
| Zustand | 5.0 | çŠ¶æ€ç®¡ç† |
| **Vitest** | **4.0** | å•å…ƒæµ‹è¯•æ¡†æ¶ |
| **Cypress** | **15.7** | E2E æµ‹è¯•æ¡†æ¶ |
| **Qwen-Plus** | via ç™¾ç‚¼ API | Agent LLMï¼ˆé€šä¹‰åƒé—®ï¼‰ |
| **A2UI** | v0.8 | Agent åŠ¨æ€ UI åè®® |

### ç›®å½•ç»“æ„

```
opc-starter/
â”œâ”€â”€ app/                          # ä¸»åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ auth/                 # è®¤è¯æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ agent/            # Agent Studio â­
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ a2ui/         # A2UI æ¸²æŸ“ç³»ç»Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ business/         # ä¸šåŠ¡ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ layout/           # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ organization/     # ç»„ç»‡æ¶æ„
â”‚   â”‚   â”‚   â””â”€â”€ ui/               # åŸºç¡€ UI (shadcn)
â”‚   â”‚   â”œâ”€â”€ pages/                # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â””â”€â”€ data/             # DataService (æ ¸å¿ƒ) â­
â”‚   â”‚   â”œâ”€â”€ stores/               # Zustand Store
â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”œâ”€â”€ agent/            # Agent å®¢æˆ·ç«¯ â­
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ tools/        # å‰ç«¯å·¥å…·æ‰§è¡Œå™¨
â”‚   â”‚   â”‚   â””â”€â”€ supabase/         # Supabase å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ hooks/                # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â”œâ”€â”€ types/                # TypeScript ç±»å‹
â”‚   â”‚   â””â”€â”€ mocks/                # MSW Mock
â”‚   â””â”€â”€ supabase/
â”‚       â”œâ”€â”€ functions/
â”‚       â”‚   â””â”€â”€ ai-assistant/    # Agent SSE ç½‘å…³ â­
â”‚       â””â”€â”€ setup.sql             # æ•°æ®åº“è„šæœ¬ (æ‰€æœ‰å˜æ›´é›†ä¸­äºæ­¤)
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ Architecture.md           # ç³»ç»Ÿæ¶æ„
â”‚   â””â”€â”€ Epics.yaml                # é¡¹ç›®è¿›åº¦
â”œâ”€â”€ _bmad/                        # BMAD æ–¹æ³•è®º (å¯é€‰å‚è€ƒ)
â””â”€â”€ AGENTS.md                     # AI Coding å¿«é€ŸæŒ‡å—
```

### æ ¸å¿ƒèƒ½åŠ›æ¨¡å—

| æ¨¡å— | å…³é”®æ–‡ä»¶ | è¯´æ˜ |
|------|----------|------|
| è®¤è¯ç³»ç»Ÿ | `app/src/auth/` | Supabase Auth + JWT |
| ç»„ç»‡æ¶æ„ | `app/src/components/organization/` | å¤šå±‚çº§å›¢é˜Ÿã€æˆå‘˜ã€è§’è‰² |
| **Agent Studio** | `app/src/components/agent/` | è‡ªç„¶è¯­è¨€ AI åŠ©æ‰‹ â­ |
| æ•°æ®åŒæ­¥ | `app/src/services/data/DataService.ts` | IndexedDB + Realtime |
| ä¸ªäººä¸­å¿ƒ | `app/src/pages/ProfilePage.tsx` | ç”¨æˆ·ä¿¡æ¯ã€å¤´åƒ |

---

## ğŸ”´ğŸŸ¢ğŸ”µ TDD æ ¸å¿ƒåŸåˆ™

### çº¢-ç»¿-é‡æ„å¾ªç¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TDD å¾ªç¯ (æ¯ä¸ªåŠŸèƒ½ç‚¹)                     â”‚
â”‚                                                             â”‚
â”‚     ğŸ”´ RED          ğŸŸ¢ GREEN         ğŸ”µ REFACTOR           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚ å†™å¤±è´¥  â”‚â”€â”€â”€â”€â–¶â”‚ å†™æœ€å°  â”‚â”€â”€â”€â”€â–¶â”‚ ä¼˜åŒ–    â”‚â”€â”€â”           â”‚
â”‚   â”‚ çš„æµ‹è¯•  â”‚     â”‚ å®ç°ä»£ç  â”‚     â”‚ é‡æ„    â”‚  â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚
â”‚        â–²                                        â”‚           â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                    (ä¸‹ä¸€ä¸ªåŠŸèƒ½ç‚¹)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| é˜¶æ®µ | ç›®æ ‡ | è§„åˆ™ |
|------|------|------|
| ğŸ”´ RED | ç¼–å†™å¤±è´¥çš„æµ‹è¯• | æµ‹è¯•å¿…é¡»æ˜ç¡®è¡¨è¾¾éœ€æ±‚æ„å›¾ |
| ğŸŸ¢ GREEN | å†™æœ€å°ä»£ç é€šè¿‡æµ‹è¯• | åªå†™åˆšå¥½è®©æµ‹è¯•é€šè¿‡çš„ä»£ç  |
| ğŸ”µ REFACTOR | ä¼˜åŒ–ä»£ç ç»“æ„ | æµ‹è¯•ä¿æŒé€šè¿‡ï¼Œæ¶ˆé™¤é‡å¤ |

### æµ‹è¯•å…ˆè¡ŒåŸåˆ™ âš ï¸ MANDATORY

```
âŒ ç¦æ­¢ï¼šå…ˆå†™ä»£ç å†è¡¥æµ‹è¯•
âŒ ç¦æ­¢ï¼šæäº¤æ²¡æœ‰æµ‹è¯•è¦†ç›–çš„æ–°åŠŸèƒ½
âŒ ç¦æ­¢ï¼šä¿®æ”¹ä»£ç åä¸è¿è¡Œæµ‹è¯•å°±æäº¤

âœ… å¿…é¡»ï¼šæ–°åŠŸèƒ½å…ˆå†™æµ‹è¯•ç”¨ä¾‹
âœ… å¿…é¡»ï¼šBug ä¿®å¤å…ˆå†™å¤ç°æµ‹è¯•
âœ… å¿…é¡»ï¼šæ¯æ¬¡æäº¤å‰è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
```

### æµ‹è¯•é‡‘å­—å¡”

| å±‚çº§ | æµ‹è¯•ç±»å‹ | è¦†ç›–ç›®æ ‡ | è¿è¡Œé¢‘ç‡ |
|------|----------|----------|----------|
| åº•å±‚ | å•å…ƒæµ‹è¯• (Vitest) | å·¥å…·å‡½æ•°ã€Servicesã€Hooks | æ¯æ¬¡ä¿å­˜ |
| ä¸­å±‚ | é›†æˆæµ‹è¯• (Vitest) | DataServiceã€Store äº¤äº’ | æ¯æ¬¡æäº¤ |
| é¡¶å±‚ | E2E æµ‹è¯• (Cypress) | ç™»å½•ã€æ ¸å¿ƒç”¨æˆ·æµç¨‹ | PR åˆå¹¶å‰ |

---

## ğŸ¤– Agent Studio å¼€å‘è§„èŒƒ

> å½“ä»»åŠ¡æ¶‰åŠ Agent ç›¸å…³å¼€å‘æ—¶ï¼Œè‡ªåŠ¨åŠ è½½æ­¤ç« èŠ‚ã€‚

### æ¶æ„æµç¨‹

```
ç”¨æˆ· â†â†’ AgentWindow (æ‚¬æµ®å¯¹è¯æ¡†)
           â†“
      useAgentChat Hook
           â†“
      SSE Client â†â†’ ai-assistant (Edge Function)
           â†“                    â†“
      Tool Executor         Qwen-Plus (ç™¾ç‚¼ API)
           â†“
      A2UI Renderer (åŠ¨æ€ UI)
```

### æ ¸å¿ƒæ–‡ä»¶

| æ–‡ä»¶ | èŒè´£ |
|------|------|
| `app/src/components/agent/AgentWindow.tsx` | æ‚¬æµ®å¯¹è¯çª—å£ |
| `app/src/hooks/useAgentChat.ts` | Agent å¯¹è¯çŠ¶æ€ç®¡ç† |
| `app/src/lib/agent/sseClient.ts` | SSE æµå¼å®¢æˆ·ç«¯ |
| `app/src/lib/agent/toolExecutor.ts` | æœ¬åœ°å·¥å…·æ‰§è¡Œå™¨ |
| `app/src/components/agent/a2ui/A2UIRenderer.tsx` | A2UI ç»„ä»¶æ¸²æŸ“å™¨ |
| `app/src/components/agent/a2ui/registry.ts` | ç»„ä»¶ç™½åå•æ³¨å†Œè¡¨ |
| `app/supabase/functions/ai-assistant/` | Agent åç«¯ç½‘å…³ |

### æ·»åŠ æ–° Agent Tool

1. **åç«¯**: åœ¨ `ai-assistant/tools.ts` æ·»åŠ å·¥å…·å®šä¹‰ (OpenAI æ ¼å¼)
2. **å‰ç«¯**: åœ¨ `app/src/lib/agent/tools/` åˆ›å»ºå·¥å…·ç›®å½•
3. **æ³¨å†Œ**: åœ¨ `app/src/lib/agent/tools/registry.ts` æ³¨å†Œ
4. **System Prompt**: åœ¨ `ai-assistant/prompts/` æ·»åŠ ä½¿ç”¨è¯´æ˜

```typescript
// å·¥å…·å®šä¹‰ç¤ºä¾‹ (OpenAI æ ¼å¼)
{
  type: "function",
  function: {
    name: "myNewTool",
    description: "å·¥å…·æè¿°",
    parameters: {
      type: "object",
      properties: { /* ... */ },
      required: ["param1"],
    },
  },
}
```

### æ·»åŠ æ–° A2UI ç»„ä»¶

1. åœ¨ `app/src/components/agent/a2ui/components/` åˆ›å»ºç»„ä»¶
2. åœ¨ `registry.ts` æ³¨å†Œç»„ä»¶ (ç™½åå•æ¨¡å¼)
3. åœ¨ `app/src/types/a2ui.ts` æ·»åŠ ç±»å‹å®šä¹‰

```typescript
// registry.ts æ³¨å†Œç¤ºä¾‹
export const A2UI_REGISTRY: A2UIComponentRegistry = {
  'my-component': MyComponent,
};
```

### A2UI Action ID è§„èŒƒ

| ç±»åˆ« | Action ID æ ¼å¼ | ç¤ºä¾‹ |
|------|---------------|------|
| å¯¼èˆª | `navigation.*` | `navigation.goTo` |
| ç”¨æˆ· | `user.*` | `user.updateProfile` |
| ç»„ç»‡ | `org.*` | `org.createTeam` |

### Mock LLM æµ‹è¯•

ä½¿ç”¨ MSW æ¨¡æ‹Ÿ Agent å“åº”ï¼š

```typescript
// app/src/mocks/handlers/agentHandlers.ts
http.post('*/functions/v1/ai-assistant', async ({ request }) => {
  // è¿”å› SSE æµå¼å“åº”
});
```

---

## ğŸ¨ è®¾è®¡ç³»ç»Ÿè§„èŒƒ

> å½“ä»»åŠ¡æ¶‰åŠ UI ç»„ä»¶å¼€å‘æ—¶ï¼Œè‡ªåŠ¨åŠ è½½æ­¤ç« èŠ‚ã€‚

### Tailwind CSS v4 è¯­æ³• (Mandatory)

```tsx
// âŒ ç¦æ­¢ï¼šv2/v3 è¯­æ³•
className="bg-opacity-50 bg-gradient-to-r"

// âœ… æ­£ç¡®ï¼šv4 è¯­æ³•
className="bg-black/50 bg-linear-to-r"
```

| ç¦æ­¢ (v2/v3) | ä½¿ç”¨ (v4) |
|--------------|-----------|
| `bg-opacity-*` | `bg-color/opacity` |
| `bg-gradient-to-*` | `bg-linear-to-*` |

### è¯­ä¹‰åŒ–é¢œè‰² (æš—è‰²æ¨¡å¼é€‚é…)

**æ ¸å¿ƒåŸåˆ™**: ä½¿ç”¨è¯­ä¹‰åŒ–é¢œè‰²ï¼Œç¦æ­¢ç¡¬ç¼–ç é¢œè‰²å€¼ã€‚

| è¯­ä¹‰åŒ–é¢œè‰² | ç”¨é€” | âŒ ç¦æ­¢ä½¿ç”¨ |
|------------|------|-------------|
| `bg-background` | é¡µé¢èƒŒæ™¯ | `bg-gray-50`, `bg-white` |
| `bg-card` | å¡ç‰‡/å®¹å™¨èƒŒæ™¯ | `bg-white` |
| `text-foreground` | ä¸»è¦æ–‡å­— | `text-gray-900`, `text-black` |
| `text-muted-foreground` | æ¬¡è¦æ–‡å­— | `text-gray-500` |
| `border` | è¾¹æ¡† | `border-gray-200` |
| `bg-primary` | ä¸»è‰²æŒ‰é’® | `bg-blue-600` |
| `bg-destructive` | å±é™©æ“ä½œ | `bg-red-600` |

```tsx
// âŒ ç¦æ­¢ï¼šç¡¬ç¼–ç é¢œè‰²
<div className="bg-white text-gray-900 border-gray-200">

// âœ… æ­£ç¡®ï¼šè¯­ä¹‰åŒ–é¢œè‰²
<div className="bg-card text-foreground border">
```

### ç§»åŠ¨ç«¯è¦†ç›–ç»„ä»¶ âš ï¸ CRITICAL

**Sidebarã€Modalã€Dropdown ç­‰è¦†ç›–å±‚å¿…é¡»ä½¿ç”¨æ˜¾å¼é¢œè‰² + `dark:` å‰ç¼€**

```tsx
// âŒ é”™è¯¯ï¼šCSS å˜é‡åœ¨ç§»åŠ¨ç«¯è¦†ç›–å±‚å¯èƒ½å¤±æ•ˆ
<aside className="bg-card text-foreground">

// âœ… æ­£ç¡®ï¼šæ˜¾å¼é¢œè‰²
<aside className="bg-white dark:bg-slate-900 text-gray-900 dark:text-gray-100">
```

---

## ğŸ’¾ æ•°æ®è®¿é—®è§„èŒƒ

### DataService ç»Ÿä¸€è®¿é—®

```typescript
// âœ… æ­£ç¡®ï¼šé€šè¿‡ DataService è®¿é—®
import { dataService } from '@/services/data/DataService'
await dataService.getAll('profiles')

// âŒ ç¦æ­¢ï¼šç›´æ¥è®¿é—®
import { supabase } from '@/lib/supabase/client'  // ç¦æ­¢
```

### æ•°æ®æµæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UI Layer â†’ Zustand Stores â†’ DataService        â”‚
â”‚                                   â”‚             â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                    â”‚         IndexedDB       â”‚  â”‚
â”‚                    â”‚    â€¢ è¯»: 100% æœ¬åœ°      â”‚  â”‚
â”‚                    â”‚    â€¢ å†™: ä¹è§‚æ›´æ–°       â”‚  â”‚
â”‚                    â”‚    â€¢ åŒæ­¥: Realtime     â”‚  â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                   â”‚             â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                    â”‚         Supabase        â”‚  â”‚
â”‚                    â”‚    â€¢ Postgres Changes   â”‚  â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SQL å˜æ›´é›†ä¸­ç®¡ç†

æ‰€æœ‰æ•°æ®åº“å˜æ›´ â†’ `app/supabase/setup.sql`ï¼ˆç¦æ­¢åˆ›å»ºç‹¬ç«‹ SQL æ–‡ä»¶ï¼‰

---

## ğŸ”Œ Supabase MCP æ“ä½œè§„èŒƒ

> å¼€å‘è¿‡ç¨‹ä¸­å¯¹ Supabase åç«¯çš„çŠ¶æ€è¯»å–å’Œå†™å…¥ï¼Œ**é»˜è®¤ä½¿ç”¨ MCP æä¾›çš„ supabase å·¥å…·**ã€‚

### æ ¸å¿ƒåŸåˆ™

1. **å®æ—¶çŠ¶æ€æ“ä½œ** â†’ ä½¿ç”¨ MCP `mcp__supabase__*` ç³»åˆ—å·¥å…·
2. **æŒä¹…åŒ–å˜æ›´åŒæ­¥** â†’ æ‰€æœ‰ç»“æ„æ€§å˜æ›´å¿…é¡»åŒæ­¥åˆ° `app/supabase/` ç›®å½•

### MCP å·¥å…·ä½¿ç”¨åœºæ™¯

| åœºæ™¯ | MCP å·¥å…· | è¯´æ˜ |
|------|----------|------|
| æŸ¥è¯¢è¡¨ç»“æ„ | `mcp__supabase__list_table` | è·å–æ•°æ®åº“è¡¨åˆ—è¡¨ |
| æŸ¥è¯¢åˆ—ä¿¡æ¯ | `mcp__supabase__list_columns` | è·å–è¡¨å­—æ®µè¯¦æƒ… |
| æ‰§è¡Œ SQL | `mcp__supabase__execute_sql` | æŸ¥è¯¢/ä¿®æ”¹æ•°æ® |
| ç”¨æˆ·ç®¡ç† | `mcp__supabase__list_auth_users` | è®¤è¯ç”¨æˆ·åˆ—è¡¨ |
| Edge Functions | `mcp__supabase__list_edge_functions` | æŸ¥çœ‹éƒ¨ç½²çš„å‡½æ•° |
| Storage ç®¡ç† | `mcp__supabase__list_storage_buckets` | å­˜å‚¨æ¡¶ç®¡ç† |

### å˜æ›´åŒæ­¥è§„èŒƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Supabase å˜æ›´åŒæ­¥æµç¨‹                             â”‚
â”‚                                                            â”‚
â”‚  MCP æ‰§è¡Œå˜æ›´ â”€â”€â”¬â”€â”€â–¶ DDL (è¡¨/RLS/å‡½æ•°)                      â”‚
â”‚                â”‚     â””â”€â”€â–¶ åŒæ­¥åˆ° app/supabase/setup.sql    â”‚
â”‚                â”‚                                           â”‚
â”‚                â””â”€â”€â–¶ Edge Function éƒ¨ç½²                     â”‚
â”‚                      â””â”€â”€â–¶ åŒæ­¥åˆ° app/supabase/functions/   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŒæ­¥æ£€æŸ¥æ¸…å•

| å˜æ›´ç±»å‹ | éœ€åŒæ­¥ä½ç½® | æ“ä½œ |
|----------|-----------|------|
| æ–°å»º/ä¿®æ”¹è¡¨ | `app/supabase/setup.sql` | è¿½åŠ  DDL è¯­å¥ |
| RLS ç­–ç•¥ | `app/supabase/setup.sql` | è¿½åŠ  POLICY è¯­å¥ |
| PostgreSQL å‡½æ•° | `app/supabase/setup.sql` | è¿½åŠ  FUNCTION å®šä¹‰ |
| Edge Function | `app/supabase/functions/<name>/` | æ›´æ–°å¯¹åº”ç›®å½•ä»£ç  |
| ç´¢å¼•/çº¦æŸ | `app/supabase/setup.sql` | è¿½åŠ  INDEX/CONSTRAINT |

### ç¤ºä¾‹å·¥ä½œæµ

```bash
# 1. ä½¿ç”¨ MCP æŸ¥è¯¢å½“å‰è¡¨ç»“æ„
mcp__supabase__list_columns(table_name="profiles")

# 2. ä½¿ç”¨ MCP æ‰§è¡Œ DDL å˜æ›´
mcp__supabase__execute_sql(sql="ALTER TABLE profiles ADD COLUMN bio TEXT;")

# 3. å°†å˜æ›´åŒæ­¥åˆ° setup.sql (âš ï¸ å¿…é¡»æ‰§è¡Œ)
# åœ¨ app/supabase/setup.sql æœ«å°¾è¿½åŠ :
# -- [2026-01-18] Add bio column to profiles
# ALTER TABLE profiles ADD COLUMN bio TEXT;

# 4. å¦‚æœæ¶‰åŠ Edge Functionï¼ŒåŒæ­¥åˆ°å¯¹åº”ç›®å½•
# app/supabase/functions/ai-assistant/index.ts
```

### ç¦æ­¢äº‹é¡¹

```
âŒ ä½¿ç”¨ MCP æ‰§è¡Œ DDL åä¸åŒæ­¥åˆ° setup.sql
âŒ ç›´æ¥ä¿®æ”¹ setup.sql è€Œä¸é€šè¿‡ MCP éªŒè¯æ‰§è¡Œ
âŒ åˆ›å»ºç‹¬ç«‹çš„ SQL è¿ç§»æ–‡ä»¶
âŒ Edge Function ä»…éƒ¨ç½²ä¸åŒæ­¥ä»£ç 
```

---

## ğŸ› Bug ä¿®å¤è§„èŒƒ

> å½“ä»»åŠ¡ä¸º Bug ä¿®å¤æ—¶ï¼Œè‡ªåŠ¨åŠ è½½æ­¤ç« èŠ‚ã€‚

### æ ¸å¿ƒåŸåˆ™ï¼šå…ˆæŸ¥æ•°æ®ï¼Œå†æ”¹ä»£ç 

```
å‘ç°é—®é¢˜ â†’ æµè§ˆå™¨è°ƒè¯•éªŒè¯ â†’ å®šä½æ ¹å›  â†’ ä¸€æ¬¡æ€§ä¿®å¤ â†’ éªŒè¯é€šè¿‡
```

### è°ƒè¯•æ­¥éª¤

1. **ä½¿ç”¨æµè§ˆå™¨ DevTools**
   - Network é¢æ¿ï¼šæ£€æŸ¥ API è¯·æ±‚å’Œå“åº”æ•°æ®
   - Console é¢æ¿ï¼šæŸ¥çœ‹æ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯

2. **æ·»åŠ ä¸´æ—¶è°ƒè¯•æ—¥å¿—**
   ```typescript
   console.log('[Debug] æ•°æ®çŠ¶æ€:', JSON.stringify(data, null, 2));
   ```

3. **å¸¸è§æ•°æ®å®Œæ•´æ€§é—®é¢˜**

| é—®é¢˜åœºæ™¯ | ç—‡çŠ¶ | æ’æŸ¥æ–¹æ³• |
|----------|------|----------|
| å¤–é”®å¼•ç”¨å¤±æ•ˆ | å…³è”æŸ¥è¯¢è¿”å› `null` | æ£€æŸ¥è¢«å¼•ç”¨è®°å½•æ˜¯å¦å­˜åœ¨ |
| æ•°ç»„åŒ…å«æ— æ•ˆ ID | æ‰¹é‡æŸ¥è¯¢è¿”å›éƒ¨åˆ†æ•°æ® | å¯¹æ¯”è¯·æ±‚ ID å’Œå“åº”æ•°æ® |
| å­—æ®µä¸ºç©º | åŠŸèƒ½ä¸ç”Ÿæ•ˆ | æ£€æŸ¥æ•°æ®åº“è®°å½•å®é™…å€¼ |

### é˜²å¾¡æ€§ç¼–ç 

```typescript
// âŒ å‡è®¾æ•°æ®ä¸€å®šæœ‰æ•ˆ
const coverUrl = await getPhotoUrl(album.photoIds[0]);

// âœ… éå†æ‰¾åˆ°ç¬¬ä¸€ä¸ªæœ‰æ•ˆé¡¹
for (const photoId of album.photoIds) {
  const url = photoUrlMap.get(photoId);
  if (url) {
    album.coverPhotoUrl = url;
    break;
  }
}
```

---

## âœ… å¼€å‘å·¥ä½œæµ

### å®Œæ•´æµç¨‹

```
éœ€æ±‚/Bug â†’ BMAD æ–¹æ¡ˆè®¨è®º(å¯é€‰) â†’ Epic/Story/Task â†’ ğŸ”´æµ‹è¯•å…ˆè¡Œ â†’ ğŸŸ¢ä»£ç å®ç° â†’ ğŸ”µé‡æ„ä¼˜åŒ– â†’ è´¨é‡éªŒè¯ â†’ äººå·¥å®¡æŸ¥ â†’ ä¸Šçº¿
```

### Phase 1: TDD æµ‹è¯•å…ˆè¡Œ ğŸ”´

```bash
npm run test:watch    # ç›‘å¬æ¨¡å¼ï¼ˆå¼€å‘æ—¶ï¼‰
```

**æµ‹è¯•æ–‡ä»¶å‘½å**: `*.test.ts` æˆ– `*.spec.ts`ï¼Œä¸æºæ–‡ä»¶åŒç›®å½•

```typescript
// app/src/services/example.test.ts
import { describe, it, expect, vi } from 'vitest'

describe('ExampleService', () => {
  it('åº”è¯¥å®Œæˆé¢„æœŸåŠŸèƒ½', async () => {
    // Arrange - å‡†å¤‡æµ‹è¯•æ•°æ®
    // Act - æ‰§è¡Œå¾…æµ‹å‡½æ•°
    // Assert - éªŒè¯ç»“æœ
  })
})
```

### Phase 2: ä»£ç å®ç° ğŸŸ¢

éµå¾ªæŠ€æœ¯çº¦æŸå®Œæˆä»£ç å®ç°ã€‚è¯¦è§ `references/coding-constraints.md`ã€‚

### Phase 3: é‡æ„ä¼˜åŒ– ğŸ”µ

```
âœ… æµ‹è¯•å…¨éƒ¨é€šè¿‡åå†é‡æ„
âœ… æ¯æ¬¡å°æ­¥é‡æ„åè¿è¡Œæµ‹è¯•
âœ… æå–å…¬å…±æ–¹æ³•ã€æ¶ˆé™¤é‡å¤

âŒ ä¸è¦åœ¨é‡æ„æ—¶æ·»åŠ æ–°åŠŸèƒ½
```

### Phase 4: è´¨é‡éªŒè¯

```bash
# ä¸€é”®è´¨é‡éªŒè¯
./scripts/quality_check.sh

# æˆ–æ‰‹åŠ¨æ‰§è¡Œ
npm run lint:check        # ESLint æ£€æŸ¥
npm run format:check      # Prettier æ ¼å¼æ£€æŸ¥
npm run type-check        # TypeScript ç±»å‹æ£€æŸ¥
npm run test              # å•å…ƒæµ‹è¯•
npm run test:e2e:headless # E2E å›å½’æµ‹è¯•
npm run build             # æ„å»ºéªŒè¯
```

| æ£€æŸ¥é¡¹ | å‘½ä»¤ | é€šè¿‡æ ‡å‡† |
|--------|------|----------|
| ESLint | `npm run lint:check` | 0 é”™è¯¯ |
| TypeScript | `npm run type-check` | 0 é”™è¯¯ |
| å•å…ƒæµ‹è¯• | `npm run test` | å…¨éƒ¨é€šè¿‡ |
| E2E æµ‹è¯• | `npm run test:e2e:headless` | å…¨éƒ¨é€šè¿‡ |
| æ„å»º | `npm run build` | æˆåŠŸ |

---

## ğŸš« ç¦æ­¢æ¸…å•

### ç¼–ç ç¦æ­¢

| ç±»åˆ« | ç¦æ­¢äº‹é¡¹ |
|------|----------|
| **Tailwind** | `*-opacity-*` è¯­æ³•ã€`bg-gradient-to-*` |
| **é¢œè‰²** | ç¡¬ç¼–ç é¢œè‰²å¦‚ `bg-white`ã€`text-gray-900`ã€`bg-blue-600` |
| **è¦†ç›–å±‚** | Sidebar/Modal/Dropdown ä½¿ç”¨ CSS å˜é‡é¢œè‰² |
| **æ•°æ®è®¿é—®** | ç›´æ¥å¯¼å…¥ `supabase` client |
| **æ–‡ä»¶ç®¡ç†** | åˆ›å»ºç‹¬ç«‹ SQL è¿ç§»æ–‡ä»¶ã€åˆ›å»ºæ–°æ–‡æ¡£æ–‡ä»¶ |
| **MCP Supabase** | æ‰§è¡Œ DDL åä¸åŒæ­¥ `setup.sql`ã€Edge Function éƒ¨ç½²åä¸åŒæ­¥ä»£ç  |
| **TypeScript** | ä½¿ç”¨ `any` ç±»å‹ |
| **React Hooks** | `useCallback` ä½œä¸º `useEffect` ä¾èµ–ï¼ˆæ—  ref guardï¼‰ |
| **Agent** | åœ¨ A2UI ä¸­ä½¿ç”¨æœªæ³¨å†Œçš„ç»„ä»¶ç±»å‹ |
| **Agent** | ç›´æ¥è°ƒç”¨ LLM APIï¼ˆå¿…é¡»é€šè¿‡ ai-assistant Edge Functionï¼‰ |

### TDD ç¦æ­¢

| ç¦æ­¢äº‹é¡¹ | åæœ |
|----------|------|
| å…ˆå†™ä»£ç å†è¡¥æµ‹è¯• | ä»£ç è®¾è®¡ä¸ä½³ï¼Œéš¾ä»¥æµ‹è¯• |
| æäº¤æ— æµ‹è¯•è¦†ç›–çš„æ–°åŠŸèƒ½ | å›å½’é£é™©ï¼Œæ— æ³•ä¿è¯è´¨é‡ |
| ä¸è¿è¡Œæµ‹è¯•å°±æäº¤ä»£ç  | CI å¤±è´¥ï¼Œé˜»å¡å…¶ä»–äºº |
| å¿½ç•¥æµ‹è¯•å¤±è´¥ç»§ç»­å¼€å‘ | é—®é¢˜å †ç§¯ï¼Œä¿®å¤æˆæœ¬å¢åŠ  |

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

### æŒ‰éœ€åŠ è½½

| æ–‡æ¡£ | å†…å®¹ | è§¦å‘å…³é”®è¯ |
|------|------|------------|
| `references/tdd-workflow.md` | TDD å®Œæ•´æµç¨‹ã€æµ‹è¯•ç¼–å†™è§„èŒƒ | vitest, cypress, test |
| `references/coding-constraints.md` | ç¼–ç çº¦æŸã€React Hooks åæ¨¡å¼ | useEffect, hooks, ltree |
| `references/project-structure.md` | é¡¹ç›®ç»“æ„ã€NPM å‘½ä»¤ | structure, npm |
| `references/db-sync-checklist.md` | æ•°æ®åº“ä¸€è‡´æ€§æ£€æŸ¥ | CHECK, migration, sql |
| `references/troubleshooting.md` | å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ | error, fix, debug |

### å¤–éƒ¨æ–‡æ¡£

| æ–‡æ¡£ | ç”¨é€” |
|------|------|
| `docs/Architecture.md` | å®Œæ•´ç³»ç»Ÿæ¶æ„ |
| `docs/Epics.yaml` | é¡¹ç›®è¿›åº¦è¿½è¸ª |
| `AGENTS.md` | AI Coding å¿«é€ŸæŒ‡å— |
| `app/supabase/SUPABASE_COOKBOOK.md` | æ•°æ®åº“æ“ä½œæ‰‹å†Œ |

### BMAD æ–¹æ³•è®ºå‚è€ƒ (å¯é€‰)

å½“éœ€è¦è§„èŒƒåŒ–éœ€æ±‚åˆ†æã€æ–¹æ¡ˆè®¾è®¡æ—¶ï¼Œå¯å‚è€ƒ BMAD å·¥ä½œæµï¼š

| Agent | ç”¨é€” |
|-------|------|
| `_bmad/bmm/agents/dev.md` (Amelia) | é«˜çº§ç ”å‘ä¸“å®¶ï¼Œç²¾å‡†æ‰§è¡Œ Story |
| `_bmad/bmm/agents/architect.md` | ç³»ç»Ÿæ¶æ„å¸ˆï¼ŒæŠ€æœ¯æ–¹æ¡ˆè®¾è®¡ |
| `_bmad/bmm/workflows/` | æ ‡å‡†åŒ–å·¥ä½œæµ |

---

## ğŸš€ å¿«é€Ÿå‘½ä»¤

```bash
# å¼€å‘
npm run dev           # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev:test      # æµ‹è¯•æ¨¡å¼ (MSW mock)

# TDD æµ‹è¯•
npm run test          # è¿è¡Œå•å…ƒæµ‹è¯•
npm run test:watch    # ç›‘å¬æ¨¡å¼ï¼ˆå¼€å‘æ—¶æ¨èï¼‰
npm run coverage      # ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š

# E2E æµ‹è¯•
npm run test:e2e      # Cypress äº¤äº’æ¨¡å¼
npm run test:e2e:headless  # Cypress æ— å¤´æ¨¡å¼ (CI)

# è´¨é‡æ£€æŸ¥
npm run lint          # ESLint æ£€æŸ¥å¹¶ä¿®å¤
npm run format        # Prettier æ ¼å¼åŒ–
npm run type-check    # TypeScript ç±»å‹æ£€æŸ¥
npm run build         # ç”Ÿäº§æ„å»º

# ä¸€é”®è´¨é‡éªŒè¯
./scripts/quality_check.sh
```

### æ¨èå·¥ä½œæµ

```bash
# 1. å¯åŠ¨æµ‹è¯•ç›‘å¬ï¼ˆæ–°ç»ˆç«¯çª—å£ï¼‰
npm run test:watch

# 2. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆå¦ä¸€ä¸ªç»ˆç«¯çª—å£ï¼‰
npm run dev:test

# 3. ğŸ”´ ç¼–å†™æµ‹è¯• â†’ çœ‹åˆ°çº¢è‰²å¤±è´¥
# 4. ğŸŸ¢ å®ç°ä»£ç  â†’ çœ‹åˆ°ç»¿è‰²é€šè¿‡
# 5. ğŸ”µ é‡æ„ä¼˜åŒ–
# 6. æäº¤å‰è¿è¡Œå®Œæ•´è´¨é‡æ£€æŸ¥
./scripts/quality_check.sh
```
